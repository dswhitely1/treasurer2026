apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Reference the base resources
bases:
  - ../../

# IMPORTANT: Secrets Management
# The base secrets.yaml contains empty values by design.
# For production deployment:
# 1. Create secrets-prod.yaml (gitignored) with actual values, OR
# 2. Use sealed secrets: kubeseal <secrets-prod.yaml >sealed-secrets.yaml, OR
# 3. Use external secrets operator to sync from vault/AWS Secrets Manager
# Never commit actual secrets to git!

# Override images for production
images:
  - name: ghcr.io/treasurer/api
    newTag: v1.0.0  # Use specific version tags in production
  - name: ghcr.io/treasurer/client
    newTag: v1.0.0

# Replicas for production
replicas:
  - name: api
    count: 3
  - name: client
    count: 3
  - name: postgres
    count: 1

# Patches for production configurations
patchesStrategicMerge:
  # Production environment variables
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: treasurer-config
    data:
      NODE_ENV: "production"
      CORS_ORIGIN: "https://treasurer.example.com"
      VITE_API_URL: "https://api.treasurer.example.com"

# Resource quotas for production namespace
resources:
  - ./namespace-quota.yaml
